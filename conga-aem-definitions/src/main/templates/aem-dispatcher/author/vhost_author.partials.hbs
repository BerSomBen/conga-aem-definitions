{{!-- Contains configuration snippets that can be used when building the vhost author template --}}


{{~#block "serverName"}}
  ServerName {{cmsAuthorHostname}}
{{/block}}


{{~#block "logSettings"}}
  # Possible values include: debug, info, notice, warn, error, crit, alert, emerg.
  LogLevel warn
  ErrorLog ${APACHE_LOG_DIR}/vhost_author_error.log
  CustomLog ${APACHE_LOG_DIR}/vhost_author_access.log combined
{{/block}}


{{~#block "rewriteEnforcePrimaryHostname"}}
  # Make sure primary hostname is always used
  RewriteEngine On
  # Don't rewrite the dispatcher invalidation URL
  RewriteCond %{REQUEST_URI} !^/dispatcher/invalidate.cache
  RewriteCond %{HTTP_HOST} !^{{regexQuote cmsAuthorHostname}}$ [NC]
  RewriteRule ^(.*)$ http://{{cmsAuthorHostname}}$1 [R=301,L]
{{/block}}


{{~#block "enableDispatcher"}}
  # Enable AEM Dispatcher
  <Location />
    <IfModule disp_apache2.c>
      ModMimeUsePathInfo On
      # enable dispatcher for ALL requests.
      SetHandler dispatcher-handler
    </IfModule>
  </Location>
{{/block}}


{{~#block "damContentDispositionHeader"}}
  # Set content disposition header for downloads
  <LocationMatch "^.*/dam/.*\.download_attachment\..*$">
    Header set Content-Disposition: attachment
  </LocationMatch>
{{/block}}


{{~#block "accessRestrictionsLocationFilter"}}
# Location filter
{{#each httpd.locationFilter~}}
{{aemHttpdFilter this allowFromKey="dispatcher.allowAdminAccessFrom" allowFromHostKey="dispatcher.allowAdminAccessFromHost"}}
{{/each~}}
{{/block}}


{{~#block "accessRestrictionsDispatcherFlush"}}
  # Allow dispatcher flushing only from defined hosts
  <Location "/dispatcher">
    <IfVersion < 2.4>
      Order Deny,Allow
      Deny from all
{{~#if dispatcher.allowFlushFrom}}
      Allow from {{dispatcher.allowFlushFrom}}
{{~/if}}
{{~#if dispatcher.allowFlushFromHost}}
      Allow from {{dispatcher.allowFlushFromHost}}
{{~/if}}
    </IfVersion>
    <IfVersion >= 2.4>
      Require all denied
{{~#if dispatcher.allowFlushFrom}}
      Require ip {{dispatcher.allowFlushFrom}}
{{~/if}}
{{~#if dispatcher.allowFlushFrom}}
      Require host {{dispatcher.allowFlushFromHost}}
{{~/if}}
    </IfVersion>

  </Location>
{{/block}}
