# Example Test Environment

nodes:

- node: aem-author
  roles:
  - role: aem-cms
    variant: aem-author
  config:
    replication.author.publishTargets:
    - name: publish1
      url: http://localhost:4503
      transportUser: admin
      # Has to be encrypted with the correct key, see http://www.wemblog.com/2012/03/how-to-use-crypto-support-in-cq55.html
      transportPassword: "{443a90a7ed2bf085c7a4a5947013b32bf617b87025bbca44786ac2b926a59f6c}"

- node: aem-publish
  roles:
  - role: aem-cms
    variant: aem-publish
  config:
    replication.publish.flushTarget:
      name: dispatcher1
      url: http:/www.sample1.com

- node: webserver
  roles:
  - role: aem-dispatcher
    variants:
    - aem-author
    - ssl
    config:
      httpd:
        serverName: author.sample.com
        accessRestriction:
          locationFilter:
          - _merge_
          - location: /location1Allow
            type: allow
          - location: /location2Deny
            type: deny
          - location: /admin
            type: allow
      dispatcher:
        cacheRootPath: /var/cache/author1
        renderInstance:
          host: localhost
          port: 4502
  - role: aem-dispatcher
    variants:
    - aem-publish
    - ssl
    config:
      httpd:
        accessRestriction:
          locationFilter:
          - location: /location3Allow
            type: allow
          - location: /location4Deny
            type: deny
          - location: /admin
            type: allow
          - _merge_
      dispatcher:
        cacheRootPath: /var/cache/publish1
        statFilesLevel: 3
        renderInstance:
          host: localhost
          port: 4503
        forwardClientHeaders:
        - referer
        - content-type
        - content-length
        - accept-charset
        - accept-encoding
        - accept-language
        - accept
        - host

config:
  jvm.path: "/usr/lib/jvm/jdk-8-oracle-x64"

  httpd:
    accessRestriction:
      adminAccessFromIp: 10.0.0.0/255.0.0.0
      adminAccessFromHost: www.example.org
      dispatcherFlushFromIp: 127.0.0.1
      dispatcherFlushFromHost: localhost
    ssl:
      certificateFile: /etc/ssl/certs/sample.crt
      certificateKeyFile: /etc/ssl/private/sample.key
      cACertificatePath: /etc/ssl/certs
      cACertificateFile: /etc/ssl/certs/sample.pem

  dispatcher:
    moduleFile: /usr/lib/apache2/modules/mod_dispatcher.so

  workflow:
    useMinimalDamUpdateAssetWorkflow: true


tenants:

- tenant: sample1.com
  config:
    httpd:
      serverAliasNames:
      - www.sample1.com
      rootRedirect.url: /en.html
      ssl.enforce: true      
    slingMappingPath: /content/sample1

- tenant: sample2.com
  config:
    httpd:
      serverNameSsl: ssl-sample2.com
      serverAliasNames:
      - www.sample2.com
      serverAliasNamesSsl:
      - www.ssl-sample2.com
      rootRedirect.url: /de.html
    slingMappingPath: /content/sample2
